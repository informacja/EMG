function [s, t] = emgresidual (t0, t1, iband, hide);% Computes the signal residual.% Copyright (c) 2006-2009. Kevin C. McGill and others.% Part of EMGlab version 1.0.% This work is licensed under the Aladdin free public license.% For copying permissions see license.txt.% email: emglab@emglab.net	global CURR SETS DECOMP		if nargin<3; iband = CURR.band; end;	if nargin<4; hide = 0; end;	s = emgsignal (t0, t1, iband);	w = SETS.band(iband).temp_width/2;	sl = emgslist (0, t0-w, t1+w);	if length(sl)>0;		if hide;			ix = cat(1,DECOMP.unit(sl(:,2)).visible);			sl = sl(logical(ix),:);		end;                sig = s.sig;        ls = length(sig);        for iu=1:DECOMP.nunits;            tx = sl(sl(:,2)==iu,1)' - s.t0 - w + s.dt/2;            if length(tx)>0;                if iband==1;                    temp = DECOMP.unit(iu).waveform.interp;                else                    temp = DECOMP.unit(iu).interpolated;                end;                temp = reshape(temp, 10, length(temp)/10)';                n = size(temp,1);                tt = round(10*tx/s.dt);                t = ceil(tt/10);                off = 10*t - tt + 1;                for i=find(t>0 & t<ls-n);                    ti = t(i)+ [1:n];                    sig(ti) = sig(ti)-temp(:,off(i));                end;                for i=find(t<=0 | t>=ls-n);                    ti = t(i) + [1:n];                    ix = find(ti>0 & ti<ls);                    ti = ti(ix);                    sig(ti) = sig(ti) - temp(ix,off(i));                end;            end;        end;        s.sig = sig;                end;	if nargout==2;		t = s.t0 + [0:length(s.sig)-1]*s.dt;		s = s.sig;	end;