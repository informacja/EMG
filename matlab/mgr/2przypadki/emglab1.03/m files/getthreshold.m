function threshold = getThreshold (sig, COEF);% Choose detection threshold based on baseline noise amplitude.% Copyright (c) 2006-2009. Kevin C. McGill and others.% Part of EMGlab version 1.0.% This work is licensed under the Aladdin free public license.% For copying permissions see license.txt.% email: emglab@emglab.net	if nargin<2; COEF = 4; end;	if isstruct(sig);		sig = sig.sig;	end;%	l = min (10000, length(sig));    l = length(sig);	s = sort(abs(sig(1:l)));	sd = sqrt(cumsum(s.^2)./[1:l]');	i = max(find(COEF*sd>s));	if isempty (i);		threshold = s(round(.9*length(s)));  % non-physiological baseline	else		threshold = s(i);	end;