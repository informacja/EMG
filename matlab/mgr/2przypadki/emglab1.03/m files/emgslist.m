function x = emgslist (opt, p1, p2, p3)% Manages the list of firing fimes.% Copyright (c) 2006-2009. Kevin C. McGill and others.% Part of EMGlab version 1.0.% This work is licensed under the Aladdin free public license.% For copying permissions see license.txt.% email: emglab@emglab.net	global DECOMP    SLIST = DECOMP.slist;		if nargin==0;		x = SLIST;		return;	elseif ~ischar (opt);		if isempty(SLIST); x=[]; return; end;		unit = opt;		if unit==0;			x = SLIST;        elseif length(unit)==1;			x = SLIST(find(SLIST(:,2)==unit),1);        else            x = SLIST;            x(end,3) = 0;            for i=1:length(unit);                x(x(:,2)==unit(i),3)=1;            end;            x = x(x(:,3)==1,1:2);		end;		if nargin==3;			x = x(x(:,1)>p1 & x(:,1)<p2, :);		end;        return;	end;		switch (lower(opt))		case 'init'		SLIST = [];			case 'concat'		if nargin==3;			p1 = [p1; p2*ones(size(p1))];		end;		SLIST = [SLIST; p1];		[b,i] = sort(SLIST(:,1));		SLIST = SLIST(i,:);			case 'delete'        if isempty(SLIST); return; end;		t = SLIST(:,1);		if nargin==2;			SLIST(t==p1,:) = [];		else			SLIST(t>p1 & t<p2,:) = [];		end;    case 'clear'        i = find(SLIST(:,2)==p1);        SLIST(i,:) = [];	case 'delete unit'		if isempty(SLIST); return; end;		i = find(SLIST(:,2)==p1);		SLIST(i,:) = [];		i = find(SLIST(:,2)>p1);		SLIST(i,2) = SLIST(i,2) - 1;			case 'shift'		if isempty(SLIST); return; end;		i = find(SLIST(:,2)==p1);		SLIST(i,1) = SLIST(i,1) - p2;			case 'reorder'		map(p1) = [1:max(p1)];		SLIST(:,2) = map(SLIST(:,2))';			case 'find'		t = emgslist (p1);		if isempty(t);			x = [];		else			a = abs(t-p2);			x = t(find(a==min(a)));		end;		case 'merge'		if isempty(SLIST); return; end;		i = find(SLIST(:,2)==p2);		SLIST(i,2) = p1;		SLIST(i,1) = SLIST(i,1) + p3;		i = find(SLIST(:,2)>p2);		SLIST(i,2) = SLIST(i,2) - 1;		[b,i] = sort(SLIST(:,1));		SLIST = SLIST(i,:);		if p2<p1;			p1 = p1 - 1;		end;		i = find(SLIST(:,2)==p1);		t = SLIST(i,1);		k = find(diff(t)<.001);		SLIST(i(k),:) = [];		case 'how many'		x = max(SLIST(:,2));			end;        DECOMP.slist = SLIST;		