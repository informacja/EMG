function put_tim(Ann, FileName)%% put_tim(Ann, FileName)%% Put annotation information to a MUtools .tim file.%% Ann:          Annotation structure.  Members are:%               Num:   Motor unit number,%               Time:  Absolute (since begin of file) firing time (samples),%               Start: Absolute begin location of pulse (samples),%               Stop:  Absolute end   location of pulse (samples).% FileName: (String) Name of the time file, with or without the%           '.tim. extension.  If the file is not in the MATLAB%           path, then specify the file name using the complete%           path name.%% This work is licensed under the Creative Commons% Attribution-NonCommercial-ShareAlike 2.5 License. To view a copy of% this license, visit http://creativecommons.org/licenses/by-nc-sa/2.5/% or send a letter to Creative Commons, 543 Howard Street, 5th Floor,% San Francisco, California, 94105, USA.% MUtools annotation files are comprised of a series of 10-byte entries,% arranged as:% 1) uint16: motor unit number,% 2) uint32: firing time, in samples since the beginning of the file,% 3) uint16: the firing time minus this value gives the location of%            the first sample in this pulse,% 4) uint16: the firing time plus  this value gives the location of%            the last  sample in this pulse,% Error checking of inputs.if nargin ~= 2, error('Must have two arguments exactly.'); endLL = length(FileName);if LL<8, error(['".tim" file name "' FileName '" too short.']); endif strcmp(FileName(LL-3:LL), '.tim')~=1, FileName = [FileName '.tim']; end% Open the time file.fid = fopen(FileName, 'w');if fid<0, error(['Can''t open file ' FileName '.']); end% Arrange data into Kamen format (absolute vs. relative Stop, Start).Ann.Start = Ann.Start - Ann.Time;Ann.Stop  = Ann.Stop  - Ann.Time;% Can't figure out how do do this efficiently.  Use brute force.for i=1:length(Ann.Num)  fwrite(fid, Ann.Num(i),   'uint16');  fwrite(fid, Ann.Time(i),  'uint32');  fwrite(fid, Ann.Start(i), 'uint16');  fwrite(fid, Ann.Stop(i),  'uint16');endfclose(fid);return