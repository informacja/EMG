function [Data, Info, Flag] = e_getEMGdat(Dname, varargin)% Loads an entire EMG data trial, from standard and legacy formats.%% [Data Info Flag] = e_getEMGdat(Dname [, OptName, OptVal] ...)%% getEMGdat() loads a complete EMG data set, supporting the WFDB standard% and certain legacy formats.  Dname is either a data file name or the% standard "record" name used to specify data in a supported format.  (In% certain formats, the record name need not match the computer file% name(s) used to store the data.)%      Option pairs are available to explicitly specify the data format,% the (partial) path to data files and the (partial) path to header% files.  Option pairs may appear in any order.  The first argument% in a pair is the (case-sensitive) string keyword.  The second argument% in a pair is the associated value.  The available keywords and% values are:%   'Format': Specifies the data format.  Available options are:%             'MUtools': MUtools format for three-channel needle EMG.%                        One data file per channel.  The three data%                        files have extensions '.sc1', '.sc2' and '.sc3'.%                        Dname is stripped of any extension.%             'WFDB': Wave Form Data Base files (see physionet.org).%                     Supports many single and multiple file formats.%                     Requires a header file for each record.  Dname%                     (stripped of any extension) specifies the%                     record name.%   'PPathDat': MATLAB partial path to the data file(s).  If multiple%               data files are used, they must be in the same directory.%               An absolute path can also be specified.  Do NOT terminate%               PPathDat with a file separator character.%   'PPathHea': MATLAB partial path to any header file.  Do NOT terminate%               with a file separator character.% NOTE: For machine portability, it is best for the calling program to%       use the MATLAB filesep() command to specify any file separator%       characters in PPathDat and PPathHea.%      If a data format is not explicitly specified, it is inferred from% Dname.  If Dname lacks a filename extension, it is considered a% WFDB record name (default).  Else, the filename extension implies the% data  format according to the following:%   {'.sc1', '.sc2', '.sc3', '.sc*'} ==> MUtools%   {'.dat', '.hea'} ==> WFDB%   Otherwise ==> WFDB%% The output variables assigned depend on the Format.% For Format = 'MUtools': Data(3,N) has three rows of data, corresponding% to files '.sc1', '.sc2' and '.sc3', respectively.  Info is assigned as% an empty matrix.  If the data read fails, Data is set to [] and Flag% is set to 2.  Else, Flag = 0.% For Format = 'WRDB', Data(Sig,N) has Sig rows of data.  Info holds% the WFDBinfo structure.  Flag codes if the data were properly read% (Flag = 0 indicates OK).%% When supported by the MATLAB version, Data is returned as type int16.% Else, Data is returned as a regular MATLAB matrix.% This work is licensed under the Creative Commons% Attribution-NonCommercial-ShareAlike 2.5 License. To view a copy of% this license, visit http://creativecommons.org/licenses/by-nc-sa/2.5/% or send a letter to Creative Commons, 543 Howard Street, 5th Floor,% San Francisco, California, 94105, USA.%%%%%%%%%%%%%%%%%%%%% Process Command Arguments %%%%%%%%%%%%%%%%%%%%%% Check command-line arguments.if nargin<1, error('No arguments supplied.  At lease one required.'); end% Loop through optional arguments.Format = [];  % Null denotes Format not yet specified.PPathDat = [];  PPathHea = [];  % Null denotes each not yet specified.I = 1;while I <= length(varargin)		switch varargin{I}				case 'Format'						if ~isempty(Format), error('Option "Format" appears twice.'); end						if I+1>length(varargin), error('Too few arguments to "Format" option.'); end						Format = varargin{I+1};						I = I + 2;  % Skip over the Format value.				case 'PPathDat'						if ~isempty(PPathDat), error('Option "PPathDat" appears twice.'); end						if I+1>length(varargin), error('Too few arguments to "PPathDat" option.'); end						PPathDat = varargin{I+1};						I = I + 2;  % Skip over the PPathDat value.				case 'PPathHea'						if ~isempty(PPathHea), error('Option "PPathHea" appears twice.'); end						if I+1>length(varargin), error('Too few arguments to "PPathHea" option.'); end						PPathHea = varargin{I+1};						I = I + 2;  % Skip over the PPathHea value.				otherwise						error(['Bogus option "' varargin{I} '".']);		endend% Set partial path defaults if they were not specified.if isempty(PPathDat), PPathDat = ''; endif isempty(PPathHea), PPathHea = ''; end% Determine implicit Format, if not specified.if isempty(Format)		Format = 'WFDB';  % Default.		I = find('.' == Dname);  % Find file extension, if any.		if ~isempty(I)  % Set Format based on extension (if any).				switch Dname(I(end)+1:end)						case {'sc1', 'sc2', 'sc3', 'sc*'}, Format = 'MUtools';						case {'dat', 'hea'}, Format = 'WFDB';				end		endend%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Get EMG Data %%%%%%%%%%%%%%%%%%%%%%%%%%%%%switch Format		case 'MUtools'				% Strip any valid file name extension.    switch Dname(max([end-3 1]):end)      case {'.sc1', '.sc2', '.sc3', '.sc*'}, Dname = Dname(1:end-4);    end				FileName = e_find_file([Dname '.sc1']);  % First data file.				if strcmp(FileName, '')  % Can't find the file.						Data = []; Info = []; Flag = 2; return				end				Data = e_get_sc123(FileName);  % Should error check the result.				Flag = 0;  Info = [];		case 'WFDB'				[Data Info Flag] = e_getWFDB(Dname);		otherwise				error(['Bogus "Format" option value "' Format '".']);endreturn